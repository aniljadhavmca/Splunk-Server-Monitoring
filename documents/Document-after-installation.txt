ğŸ§© PHASE 1 â€” FIX DATA INGESTION


ğŸ”´ STARTING POINT

index=main source="/var/log/simple_metrics.log"
| rex "%Cpu\(s\):.*?(?<idle>\d+\.\d+)\s+id"
| table idle

And got:

âŒ 0 events

âœ… STEP 1 â€” Check If File Exists

On EC2:
ls -l /var/log/simple_metrics.log

If file NOT found:
sudo touch /var/log/simple_metrics.log
sudo chmod 644 /var/log/simple_metrics.log

âœ… STEP 2 â€” Configure Splunk To Monitor File

sudo mkdir -p /opt/splunk/etc/system/local
sudo vi /opt/splunk/etc/system/local/inputs.conf

Add:
[monitor:///var/log/simple_metrics.log]
disabled = false
index = main
sourcetype = simple_metrics

Save

âœ… STEP 3 â€” Restart Splunk

sudo /opt/splunk/bin/splunk restart

âœ… STEP 4 â€” Test Basic Ingestion
In Splunk Search:

index=main sourcetype=simple_metrics
| stats count

If still 0 â†’ go to Phase 2.

ğŸ§© PHASE 2 â€” FIX TIMESTAMP PROBLEM
âš ï¸ Without timestamp, Splunk assigns wrong time (2038 issue).

âœ… STEP 5 â€” Clear Old Log
sudo truncate -s 0 /var/log/simple_metrics.log

âœ… STEP 6 â€” Add props.conf
sudo vi /opt/splunk/etc/system/local/props.conf

Add
[simple_metrics]
TIME_PREFIX = ^
TIME_FORMAT = %Y-%m-%d %H:%M:%S
MAX_TIMESTAMP_LOOKAHEAD = 19

Restart Splunk again:
sudo /opt/splunk/bin/splunk restart

ğŸ§© PHASE 3 â€” START CORRECT LOGGING
âœ… STEP 7 â€” Start Continuous Logging With Timestamp
RUN on EC2

while true; do
  echo "$(date '+%Y-%m-%d %H:%M:%S') $(top -b -n1 | grep 'Cpu(s)')" >> /var/log/simple_metrics.log
  echo "$(date '+%Y-%m-%d %H:%M:%S') $(top -b -n1 | grep 'MiB Mem')" >> /var/log/simple_metrics.log
  sleep 5
done

Leave running.

âœ… STEP 8 â€” Verify File Updating
Open new terminal:

tail -f /var/log/simple_metrics.log

You must see:

2026-02-25 21:45:01 %Cpu(s): ...
2026-02-25 21:45:01 MiB Mem : ...

ğŸ§© PHASE 4 â€” VERIFY SPLUNK TIME

âœ… STEP 9 â€” Check Splunk _time
Run:

index=main sourcetype=simple_metrics
| table _time _raw
| head 5

âœ” _time must match current time
âŒ Not 2038
âŒ Not old time

ğŸ§© PHASE 5 â€” TEST CPU EXTRACTION

âœ… STEP 10 â€” Test CPU Extraction

index=main sourcetype=simple_metrics
| rex "%Cpu\(s\):.*?(?<idle>\d+\.\d+)\s+id"
| table _time idle

You should see idle values.

âœ… STEP 11 â€” Convert To CPU Usage

index=main sourcetype=simple_metrics
| rex "%Cpu\(s\):.*?(?<idle>\d+\.\d+)\s+id"
| eval cpu_usage=round(100-idle,2)
| table _time cpu_usage

ğŸ§© PHASE 6 â€” STRESS TEST

âœ… STEP 12 â€” Install Stress
sudo yum install stress -y

âœ… STEP 13 â€” Run CPU Stress
stress --cpu $(nproc) --timeout 60

âœ… STEP 14 â€” Verify Spike
In Splunk:

index=main sourcetype=simple_metrics
| rex "%Cpu\(s\):.*?(?<idle>\d+\.\d+)\s+id"
| eval cpu_usage=round(100-idle,2)
| timechart span=10s avg(cpu_usage)

You MUST see spike above 80â€“95%.

ğŸ§© PHASE 7 â€” CREATE DASHBOARD (CLASSIC)
